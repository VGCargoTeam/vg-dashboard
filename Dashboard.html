<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Charter Dashboard</title>
  <script src="script.js" defer></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('https://images.pexels.com/photos/358319/pexels-photo-358319.jpeg') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      min-height: 100vh;
    }
    .main {
      flex: 1;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(6px);
      padding: 30px;
      margin: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      position: relative;
    }
    .calendar {
      /* Breite des Kalenders anpassen, um mehr Platz für Tooltips zu lassen */
      width: 500px; /* Hier kannst du experimentieren, z.B. 550px oder 600px */
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(6px);
      padding: 20px;
      margin: 20px 20px 20px 0;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      /* Hinzugefügt: Stellt sicher, dass der Kalender selbst den Tooltip nicht abschneidet */
      overflow: visible; 
    }
    .calendar-wrapper { /* Der Container für die beiden Monate */
        /* Hinzugefügt: Stellt sicher, dass der Wrapper den Tooltip nicht abschneidet */
        overflow: visible; 
    }
    input[type="text"], input[type="date"] {
      padding: 6px 10px;
      margin: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      border-radius: 8px;
      /* overflow: hidden;  --> Diese Zeile könnte Tooltips beschneiden, wenn sie hier war.
                            Falls doch benötigt, z.B. für abgerundete Ecken, 
                            muss der Tooltip an body gehängt werden.
                            In diesem Fall ist es unwahrscheinlich, dass table overflow hidden hat. */
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background-color: #007BFF;
      color: white;
    }
    .nav button, .btn {
      padding: 6px 12px;
      margin: 3px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }
    .nav button {
      background-color: #28a745; /* grün */
      color: white;
    }
    .nav button:hover {
      background-color: #218838; /* dunkleres grün */
    }
    .btn-view { background-color: #17a2b8; color: white; }
    .btn-delete { background-color: #dc3545; color: white; }
    .summary {
      text-align: right;
      font-weight: bold;
      margin-top: 10px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 2000; /* Stellt sicher, dass das Modal über allem liegt */
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 700px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      max-height: 90vh; /* Begrenzt die Höhe des Modals */
      overflow-y: auto; /* Aktiviert Scrollen bei zu viel Inhalt */
    }
    .modal-content p {
      flex: 1 1 45%;
      margin: 0;
    }
    .modal-content input, .modal-content textarea {
      width: 100%;
      padding: 6px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 13px;
    }
    .logo {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100; /* Stellt sicher, dass das Logo über dem Hintergrund liegt */
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: bold;
      margin-top: 8px;
    }
    .checkbox-label input[type="checkbox"] {
      transform: translateY(-1px);
    }

    /* KALENDER-STILE */
    .calendar-block table {
      width: 100%;
      table-layout: fixed;
    }
    .calendar-block th, .calendar-block td {
      width: calc(100% / 7);
      padding: 10px 5px;
      height: 50px; 
      vertical-align: top;
      font-size: 14px;
      position: relative; 
      overflow: visible; /* WICHTIG: Erlaubt dem Tooltip, über die Zellgrenzen hinauszugehen */
    }
    .calendar-day {
      cursor: pointer;
      background-color: #e9ecef;
      transition: background-color 0.2s ease;
    }
    .calendar-day:hover {
      background-color: #d1d9e0;
    }
    .calendar-day.has-flights {
      background-color: #ffc107; /* Gelb für Tage mit Flügen */
      font-weight: bold;
      color: #333;
    }
    .calendar-day.has-flights:hover {
      background-color: #e0a800;
    }
    .calendar-day.empty {
      background-color: #f8f9fa;
      cursor: default;
    }
    .flight-icon {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 1.2em;
      color: #007BFF;
    }

    /* TOOLTIP-STILE */
    [data-tooltip] {
      position: relative; /* Muss relativ sein, damit ::after und ::before absolut positioniert werden können */
      z-index: 1; /* Stellt sicher, dass die Zelle selbst über dem Hintergrund liegt */
    }

    /* Der Tooltip Text */
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      /* Positionierung oberhalb und zentriert relativ zur Zelle */
      bottom: calc(100% + 5px); /* 5px Abstand zur Zelle */
      left: 50%;
      transform: translateX(-50%); /* Zentriert den Tooltip horizontal */
      
      background-color: rgba(0, 0, 0, 0.9); /* Dunklerer Hintergrund */
      color: #fff;
      padding: 8px 12px;
      border-radius: 6px;
      white-space: pre-wrap; /* Wichtig für Zeilenumbrüche im Tooltip-Text */
      z-index: 1000; /* Sehr hoher z-index, damit der Tooltip über allen anderen Elementen liegt */
      min-width: 180px; /* Minimale Breite */
      max-width: 280px; /* Maximale Breite, passt sich dynamisch an, wenn kürzer */
      text-align: left;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      pointer-events: none; /* Sorgt dafür, dass der Tooltip keine Klicks abfängt */
      opacity: 0; /* Standardmäßig unsichtbar */
      visibility: hidden; /* Standardmäßig ausgeblendet */
      transition: opacity 0.2s, visibility 0.2s; /* Sanfter Übergang */

      /* Zusätzliche Anpassung, um zu verhindern, dass er links abgeschnitten wird */
      /* Berechnet den linken Rand basierend auf der max-width des Tooltips und dem linken Rand des Kalenders.
         Sicherstellung, dass er nicht negativ wird. */
      left: max(10px, 50% - 140px); /* 140px ist die Hälfte von max-width 280px */
      right: auto; /* Stellt sicher, dass es nicht von rechts begrenzt wird */
      transform: none; /* Entfernt die zentrale Transformation, wenn link/right explizit gesetzt sind */
      /* Man könnte auch calc(50vw - ...) benutzen, wenn der Tooltip nur auf der rechten Seite ist */
    }

    /* Das Tooltip Dreieck */
    [data-tooltip]:hover::before {
      content: '';
      position: absolute;
      /* Positionierung unter dem Tooltip-Text, zeigt auf die Zelle */
      bottom: 100%; /* Positioniert es direkt unter dem ::after Element */
      left: 50%;
      transform: translateX(-50%) translateY(5px); /* Zentriert das Dreieck und verschiebt es nach unten */
      border-width: 5px;
      border-style: solid;
      border-color: rgba(0, 0, 0, 0.9) transparent transparent transparent; /* Farbe des Dreiecks */
      z-index: 1001; /* Über dem Tooltip-Text */
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }

    /* Beim Hovern den Tooltip und das Dreieck sichtbar machen */
    [data-tooltip]:hover::after,
    [data-tooltip]:hover::before {
      opacity: 1;
      visibility: visible;
    }

    /* Modal spezifische Stile (zur besseren Lesbarkeit hier getrennt, kann auch oben rein) */
    .modal-section {
      background: #f7f7f7;
      padding: 15px;
      border-radius: 10px;
      width: 100%;
    }
    .modal-section h3 {
      margin-top: 0;
      font-size: 1.1rem;
      color: #444;
    }
    .modal-section label {
      display: block;
      margin-top: 8px;
      font-weight: bold;
    }
    .modal-section input, .modal-section textarea {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="logo">
    <img src="VG_Cargo_logo_small.png" alt="VG Cargo Logo" style="height:50px;">
  </div>
  <div class="main">
    <h1>Charter Dashboard</h1>

    <button onclick="createNewRequest()" style="margin: 10px 0 20px; padding: 10px 16px; background-color: #007BFF; color: white; border: none; border-radius: 6px; cursor: pointer;">
      Charter Anfrage erstellen
    </button>

    <div style="text-align: center; font-size: 16px; color: #e63244;">
      <span id="currentDate">Date: --</span> | <span id="clock">Time: --:--:--</span>
    </div>
    <div style="margin-top: 10px;">
      <label>Reference:</label> <input type="text" id="refSearch" onkeyup="filterTable()" />
      <label>Airline:</label> <input type="text" id="airlineSearch" onkeyup="filterTable()" />
      <label>From:</label> <input type="date" id="fromDate" onchange="filterTable()" />
      <label>To:</label> <input type="date" id="toDate" onchange="filterTable()" />
    </div>
    <div class="summary" id="summaryInfo">Total Flights: 0 | Total Tonnage: 0 kg</div>
    <table id="dataTable"><thead><tr><th>Reference</th><th>Date</th><th>Airline</th><th>Tonnage</th><th>Action</th></tr></thead><tbody></tbody></table>
    <div class="modal" id="detailModal">
      <div class="modal-content">
        <span style="position:absolute; top:10px; right:20px; cursor:pointer;" onclick="closeModal()">✖</span>
        <div id="modalBody" style="width:100%; display:flex; flex-wrap:wrap; gap:20px;"></div>
      </div>
    </div>
  </div>
  <div class="calendar">
    <div class="nav">
      <button onclick="shiftCalendar(-1)">← Back</button>
      <button onclick="shiftCalendar(1)">Forward →</button>
    </div>
    <div id="calendarArea" class="calendar-wrapper"></div>
  </div>
</body>
</html>
