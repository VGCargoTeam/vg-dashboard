
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>VG Cargo Dashboard</title>
  <style>
    body { font-family: Arial; background: #eef; margin: 0; padding: 20px; display: flex; gap: 20px; }
    .main, .calendar { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 12px rgba(0,0,0,0.1); }
    .calendar-table { margin-bottom: 20px; }
    .calendar-nav button { margin-right: 10px; padding: 6px 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    td.marked { background: #ffc107; font-weight: bold; position: relative; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #007BFF; color: white; }
    .summary { margin-top: 10px; text-align: right; font-weight: bold; }
    .time-display { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 10px; text-align: center; }
    .delete-btn { padding: 6px 14px; font-size: 14px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .ref-link { background-color: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .ref-link:hover { background-color: #117a8b; }
  </style>
</head>
<body>
  <div class="main" style="flex:2;">
    <h2>Charter Dashboard</h2>
    <div class="time-display">
      <span id="currentDate">Date: --</span> | <span id="clock">Time: --:--:--</span>
    </div>
    <div>
      <label>Reference: <input type="text" id="refSearch" onkeyup="filterTable()"></label>
      <label>Airline: <input type="text" id="airlineSearch" onkeyup="filterTable()"></label>
      <label>Flugnummer: <input type="text" id="flightNumberSearch" onkeyup="filterTable()"></label>
      <label>Von: <input type="date" id="startDate" onchange="filterTable()"></label>
      <label>Bis: <input type="date" id="endDate" onchange="filterTable()"></label>
      <label><input type="checkbox" id="showArchive" onchange="filterTable()"> Archiv zeigen</label>
    </div>
    <div class="summary" id="summaryInfo">Total Flights: 0 | Total Tonnage: 0 kg</div>
    <table>
      <thead>
        <tr><th>Reference</th><th>Flight No.</th><th>Date</th><th>Airline</th><th>Tonnage (kg)</th><th>Actions</th></tr>
      </thead>
      <tbody id="dataTable"></tbody>
    </table>
  </div>
  <div class="calendar" style="flex:1;">
    <div class="calendar-nav">
      <button onclick="shiftCalendar(-1)">← Back</button>
      <button onclick="shiftCalendar(1)">Forward →</button>
    </div>
    <div id="calendarArea"></div>
  </div>

  <script>
    let requestData = [
      { ref: "CC-20250605-094U", flightNumber: "LH123", date: new Date("2025-06-07"), airline: "Klassen Air", tonnage: 124, flightTime: "12:15" },
      { ref: "CC-20250605-DDJX", flightNumber: "TEST42", date: new Date("2025-06-06"), airline: "Test Air", tonnage: 1244, flightTime: "08:45" }
    ];
    let calendarBase = new Date();

    function populateRows() {
      const table = document.getElementById("dataTable");
      table.innerHTML = "";
      requestData.forEach(r => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><button class="ref-link" onclick="alert('Details für ${r.ref}')">${r.ref}</button></td>
          <td>${r.flightNumber || "-"}</td>
          <td>${r.date.toLocaleDateString('de-DE')}</td>
          <td>${r.airline}</td>
          <td>${r.tonnage.toLocaleString('de-DE')}</td>
          <td><button class="delete-btn" onclick="alert('Löschen: ${r.ref}')">Delete</button></td>`;
        table.appendChild(row);
      });
      filterTable();
      renderCalendars();
    }

    function filterTable() {
      const refVal = document.getElementById("refSearch").value.toLowerCase();
      const airlineVal = document.getElementById("airlineSearch").value.toLowerCase();
      const flightVal = document.getElementById("flightNumberSearch").value.toLowerCase();
      const startDate = new Date(document.getElementById("startDate").value);
      const endDate = new Date(document.getElementById("endDate").value);
      const showArchive = document.getElementById("showArchive").checked;

      const rows = document.querySelectorAll("#dataTable tr");
      let totalFlights = 0;
      let totalTonnage = 0;

      rows.forEach(row => {
        const cells = row.children;
        const ref = cells[0].textContent.toLowerCase();
        const flight = cells[1].textContent.toLowerCase();
        const date = new Date(cells[2].textContent.split('.').reverse().join('-'));
        const airline = cells[3].textContent.toLowerCase();
        const tonnage = parseFloat(cells[4].textContent.replace('.', '').replace(',', '.')) || 0;

        const showRow = (!refVal || ref.includes(refVal)) &&
                        (!airlineVal || airline.includes(airlineVal)) &&
                        (!flightVal || flight.includes(flightVal)) &&
                        (!startDate.getTime() || date >= startDate) &&
                        (!endDate.getTime() || date <= endDate);

        row.style.display = showRow ? "" : "none";
        if (showRow) {
          totalFlights++;
          totalTonnage += tonnage;
        }
      });

      document.getElementById("summaryInfo").textContent =
        `Total Flights: ${totalFlights} | Total Tonnage: ${totalTonnage.toLocaleString('de-DE')} kg`;
    }

    function shiftCalendar(offset) {
      calendarBase.setMonth(calendarBase.getMonth() + offset);
      renderCalendars();
    }

    function renderCalendars() {
      const container = document.getElementById("calendarArea");
      container.innerHTML = "";
      for (let i = 0; i < 2; i++) {
        const current = new Date(calendarBase.getFullYear(), calendarBase.getMonth() + i);
        container.innerHTML += generateCalendar(current.getFullYear(), current.getMonth());
      }
    }

    function generateCalendar(year, month) {
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const firstDay = new Date(year, month, 1).getDay() || 7;
      const monthName = new Date(year, month).toLocaleString('default', { month: 'long' });

      let html = '<div class="calendar-table">';
      html += `<h4>${monthName} ${year}</h4><table><thead><tr><th>Mo</th><th>Di</th><th>Mi</th><th>Do</th><th>Fr</th><th>Sa</th><th>So</th></tr></thead><tbody>`;
      let day = 1;
      let started = false;

      for (let i = 0; i < 6; i++) {
        html += "<tr>";
        for (let j = 1; j <= 7; j++) {
          const realDay = j;
          if (!started && realDay === firstDay) started = true;

          if (started && day <= daysInMonth) {
            const matches = requestData.filter(x =>
              x.date.getDate() === day &&
              x.date.getMonth() === month &&
              x.date.getFullYear() === year
            );

            const tooltip = matches.map(m =>
              `✈ ${m.ref} – ${m.airline}\nFlugnummer: ${m.flightNumber || "-"}\nAbflugzeit: ${m.flightTime || "-"}\nTonnage: ${m.tonnage?.toLocaleString('de-DE')} kg`
            ).join('\n');

            const marked = matches.length ? "marked" : "";
            const onclick = matches.length ? `onclick="alert('Details für ${matches[0].ref}')"` : "";
            html += `<td class="${marked}" title="${tooltip}" style="cursor:pointer;" ${onclick}>${day}</td>`;
            day++;
          } else {
            html += "<td></td>";
          }
        }
        html += "</tr>";
        if (day > daysInMonth) break;
      }
      html += "</tbody></table></div>";
      return html;
    }

    function updateClock() {
      const now = new Date();
      document.getElementById("clock").textContent = now.toLocaleTimeString('de-DE');
      document.getElementById("currentDate").textContent = now.toLocaleDateString('de-DE');
    }

    document.addEventListener("DOMContentLoaded", () => {
      populateRows();
      updateClock();
      setInterval(updateClock, 1000);
    });
  </script>
</body>
</html>
