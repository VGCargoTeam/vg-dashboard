<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VG Cargo Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef;
      margin: 0;
      padding: 20px;
      display: flex;
      gap: 20px;
    }
    .main {
      flex: 2;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    .calendar {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #007BFF;
      color: white;
    }
    .summary {
      margin-top: 10px;
      text-align: right;
      font-weight: bold;
    }
    .calendar-nav {
      margin-bottom: 10px;
    }
    .calendar-table {
      margin-bottom: 20px;
    }
    td.marked {
      background: #ffc107;
      font-weight: bold;
      cursor: help;
    }
    .info {
      margin: 10px 0;
      font-size: 14px;
      color: #007BFF;
    }
    button.delete-btn {
      padding: 6px 14px;
      font-size: 14px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button.delete-btn:hover {
      background-color: #a71d2a;
    }
  </style>
</head>
<body>
  <div class="main">
    <h2>Charter Dashboard</h2>
    <div class="info">
      <span id="currentDate">Date: --</span> | <span id="clock">Time: --:--:--</span>
    </div>
    <div>
      <label>Reference:</label> <input type="text" id="refSearch" onkeyup="filterTable()" />
      <label>Airline:</label> <input type="text" id="airlineSearch" onkeyup="filterTable()" />
    </div>
    <div class="summary" id="summaryInfo">Total Flights: 0 | Total Tonnage: 0 kg</div>
    <table>
      <thead>
        <tr><th>Reference</th><th>Date</th><th>Airline</th><th>Tonnage (kg)</th><th>Actions</th></tr>
      </thead>
      <tbody id="dataTable"></tbody>
    </table>

    

<div id="detailModal" style="display:none; position:fixed; top:5%; left:50%; transform:translateX(-50%);
 background:white; border-radius:10px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.2); z-index:1000; width:600px; max-height:90vh; overflow-y:auto; font-family:Arial, sans-serif;">
  <h2 style="margin-top:0; color:#007bff;">Flugdetails & Bearbeitung</h2>
  <div style="margin-bottom:20px;">
    <h4 style="margin-bottom:5px; border-bottom:1px solid #ccc;">Kundendaten (Original)</h4>
    <p><strong>Ref:</strong> <span id="viewRef"></span></p>
    <p><strong>Airline:</strong> <span id="viewAirline"></span></p>
    <p><strong>Datum:</strong> <span id="viewDate"></span></p>
    <p><strong>Tonnage:</strong> <span id="viewTonnage"></span></p>
    <p><strong>Billing Company:</strong> <span id="viewBillingCompany"></span></p>
    <p><strong>Billing Address:</strong> <span id="viewBillingAddress"></span></p>
    <p><strong>Tax Number:</strong> <span id="viewTaxNumber"></span></p>
    <p><strong>Contact Name:</strong> <span id="viewContactName"></span></p>
    <p><strong>Contact Email:</strong> <span id="viewContactEmail"></span></p>
    <p><strong>Original Mail:</strong><br><pre id="viewEmailRequest" style="background:#f8f8f8; padding:10px; border-radius:5px;"></pre></p>
    <p><strong>AGB akzeptiert:</strong> ✅</p>
    <p><strong>Leistungsverzeichnis gelesen:</strong> ✅</p>
  </div>
  <div>
    <h4 style="margin-bottom:5px; border-bottom:1px solid #ccc;">Interne Bearbeitung</h4>
    <form id="detailForm">
      <input type="hidden" id="modalRef" />
      <label>Kunde (Name):</label>
      <input type="text" id="customerName" style="width:100%;" /><br><br>
      <label>E-Mail:</label>
      <input type="email" id="customerEmail" style="width:100%;" /><br><br>
      <label>Flugzeit:</label>
      <input type="text" id="flightTime" placeholder="z.B. 14:45" style="width:100%;" /><br><br>
      <label>Manifestgewicht (kg):</label>
      <input type="number" id="manifestWeight" style="width:100%;" /><br><br>
      <label>Rate (€):</label>
      <input type="number" id="rate" style="width:100%;" /><br><br>
      <label>Weitere Preise:</label>
      <textarea id="otherPrices" placeholder="z.B. Handling: 500 €, Trucking: 300 €" style="width:100%;"></textarea><br><br>
      <div style="text-align:right;">
        <button type="button" onclick="saveDetails()" style="background:#28a745;color:white;border:none;padding:8px 16px;border-radius:5px;">Speichern</button>
        <button type="button" onclick="closeModal()" style="background:#6c757d;color:white;border:none;padding:8px 16px;border-radius:5px;">Schließen</button>
      </div>
    </form>
  </div>
</div>

</div>

</div>
  <div class="calendar">
    <div class="calendar-nav">
      <button onclick="shiftCalendar(-1)">← Back</button>
      <button onclick="shiftCalendar(1)">Forward →</button>
    </div>
    <div id="calendarArea"></div>
  </div>

  

    function deleteRequest(ref) {
      if (confirm("Are you sure you want to delete this request?")) {
        const index = requestData.findIndex(r => r.ref === ref);
        if (index !== -1) requestData.splice(index, 1);
        populateRows();
      }
    }

    function openDetails(ref) {
      const r = requestData.find(r => r.ref === ref);
      if (r) {
        document.getElementById("modalRef").value = r.ref;
    document.getElementById("viewRef").textContent = r.ref;
    document.getElementById("viewAirline").textContent = r.airline;
    document.getElementById("viewDate").textContent = r.date;
    document.getElementById("viewTonnage").textContent = r.tonnage + " kg";
    document.getElementById("viewBillingCompany").textContent = r.billingCompany || "-";
    document.getElementById("viewBillingAddress").textContent = r.billingAddress || "-";
    document.getElementById("viewTaxNumber").textContent = r.taxNumber || "-";
    document.getElementById("viewContactName").textContent = r.contactName || "-";
    document.getElementById("viewContactEmail").textContent = r.contactEmail || "-";
    document.getElementById("viewEmailRequest").textContent = r.emailRequest || "-";

        document.getElementById("customerName").value = r.customerName || "";
        document.getElementById("customerEmail").value = r.customerEmail || "";
        document.getElementById("flightTime").value = r.flightTime || "";
        document.getElementById("manifestWeight").value = r.manifestWeight || r.tonnage || "";
        document.getElementById("rate").value = r.rate || "";
        document.getElementById("otherPrices").value = r.otherPrices || "";
        document.getElementById("detailModal").style.display = "block";
      }
    }

    function closeModal() {
      document.getElementById("detailModal").style.display = "none";
    }

    function saveDetails() {
      const ref = document.getElementById("modalRef").value;
      const r = requestData.find(r => r.ref === ref);
      if (r) {
        r.customerName = document.getElementById("customerName").value;
        r.customerEmail = document.getElementById("customerEmail").value;
        r.flightTime = document.getElementById("flightTime").value;
        r.manifestWeight = parseFloat(document.getElementById("manifestWeight").value) || 0;
        r.rate = parseFloat(document.getElementById("rate").value) || 0;
        r.otherPrices = document.getElementById("otherPrices").value;
        r.tonnage = r.manifestWeight;
      }
      closeModal();
      populateRows();
    }

    function populateRows() {
      const table = document.getElementById("dataTable");
      table.innerHTML = "";
      requestData.forEach(r => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><a href="#" onclick="openDetails('${r.ref}')">${r.ref}</a></td>
          <td>${r.date}</td>
          <td>${r.airline}</td>
          <td>${(r.manifestWeight || r.tonnage).toLocaleString()}</td>
          <td><button class="delete-btn" onclick="deleteRequest('${r.ref}')">Delete</button></td>`;
        table.appendChild(row);
      });
      filterTable();
      renderCalendars();
    }

    function filterTable() {
      const refVal = document.getElementById("refSearch").value.toLowerCase();
      const airlineVal = document.getElementById("airlineSearch").value.toLowerCase();
      const rows = document.querySelectorAll("#dataTable tr");
      let totalFlights = 0;
      let totalTonnage = 0;

      rows.forEach(row => {
        const cells = row.children;
        const ref = cells[0].textContent.toLowerCase();
        const airline = cells[2].textContent.toLowerCase();
        const tonnage = parseFloat(cells[3].textContent.replace(/,/g, ""));
        const show = (!refVal || ref.includes(refVal)) && (!airlineVal || airline.includes(airlineVal));
        row.style.display = show ? "" : "none";
        if (show) {
          totalFlights++;
          totalTonnage += tonnage;
        }
      });

      document.getElementById("summaryInfo").textContent =
        `Total Flights: ${totalFlights} | Total Tonnage: ${totalTonnage.toLocaleString()} kg`;
    }

    function updateClock() {
      const now = new Date();
      const local = new Date(now.getTime() + (2 * 60 * 60 * 1000));
      document.getElementById("clock").textContent = "Time: " + local.toTimeString().substr(0, 8);
      document.getElementById("currentDate").textContent = "Date: " + local.toISOString().substr(0, 10);
    }

    let calendarBase = new Date(2025, 3);
    function shiftCalendar(offset) {
      calendarBase.setMonth(calendarBase.getMonth() + offset);
      renderCalendars();
    }

    function renderCalendars() {
      const container = document.getElementById("calendarArea");
      container.innerHTML = "";
      for (let i = 0; i < 2; i++) {
        const current = new Date(calendarBase.getFullYear(), calendarBase.getMonth() + i);
        container.innerHTML += generateCalendar(current.getFullYear(), current.getMonth());
      }
    }

    function generateCalendar(year, month) {
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const firstDay = new Date(year, month, 1).getDay();
      const monthName = new Date(year, month).toLocaleString('default', { month: 'long' });
      let html = `<div class="calendar-table"><h4>${monthName} ${year}</h4><table><thead><tr><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th><th>Su</th></tr></thead><tbody>`;
      let day = 1;
      let started = false;
      for (let i = 0; i < 6; i++) {
        html += "<tr>";
        for (let j = 1; j <= 7; j++) {
          const realDay = (j + 6) % 7;
          if (!started && realDay === firstDay) started = true;
          if (started && day <= daysInMonth) {
            const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
            const match = requestData.find(x => x.date === dateStr);
            const tooltip = match ? `${match.ref}\n${match.airline}\n${match.tonnage} kg` : "";
            const marked = match ? "marked" : "";
            html += `<td class='${marked}' title="${tooltip}">${day}</td>`;
            day++;
          } else {
            html += "<td></td>";
          }
        }
        html += "</tr>";
        if (day > daysInMonth) break;
      }
      html += "</tbody></table></div>";
      return html;
    }

    setInterval(updateClock, 1000);
    updateClock();
    setTimeout(populateRows, 100);
  </script>
<script src="script.js"></script></body>
</html>
